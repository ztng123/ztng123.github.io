---
layout: post
title: ğŸ—“ï¸ êµ¬ê¸€ ìº˜ë¦°ë” API (3) ë™ê¸°í™”
tags: [google]
---

íš¨ìœ¨ì ìœ¼ë¡œ ìº˜ë¦°ë” ë°ì´í„°ë¥¼ ë™ê¸°í™” í•´ ëŒ€ì—­í­ ì ˆì•½í•˜ê¸°

---

## ğŸ”„ ì¦ë¶„ ë™ê¸°í™”

&nbsp;

íš¨ìœ¨ì„±ê³¼ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ë©°, ì „ì²´ ë°ì´í„° ì„¸íŠ¸ë¥¼ ë§¤ë²ˆ ê°€ì ¸ì˜¤ëŠ” ëŒ€ì‹  ë³€ê²½ëœ ë¶€ë¶„ë§Œ ë™ê¸°í™”

&nbsp;

- ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„±
- ì„±ëŠ¥ ìµœì í™”
- ì„œë²„ ë¶€í•˜ ê°ì†Œ
- ì¶©ëŒ ê°ì†Œ

&nbsp;

1. í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë¥¼ ì„œë²„ ìƒíƒœì™€ ì™„ì „íˆ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ ì²˜ìŒì—” ì´ˆê¸° ì „ì²´ ë™ê¸°í™”

&nbsp;

2. ì¦ë¶„ ë™ê¸°í™”ê°€ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ê³  ì´ì „ ë™ê¸°í™” ì´í›„ ë°œìƒí•œ ëª¨ë“  ë³€ê²½ì‚¬í•­ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
   ë§¤ë²ˆ ì„œë²„ì—ì„œ ì–»ì€ ì´ì „ ë™ê¸°í™” í† í°ì„ ì œê³µí•˜ê³  ì‘ë‹µì˜ ìƒˆ ë™ê¸°í™” í† í° ì €ì¥

&nbsp;

> `ì´ˆê¸° ì „ì²´ ë™ê¸°í™”` : ë™ê¸°í™”í•˜ë ¤ëŠ” ì»¬ë ‰ì…˜ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì›ë˜ ìš”ì²­

&nbsp;

> `ë™ê¸°í™” í† í°` : ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì— êµí™˜ë˜ëŠ” ë°ì´í„°, ë™ê¸°í™” í”„ë¡œì„¸ìŠ¤ì—ì„œ ì¤‘ìš”í•œ ì—­í• 

&nbsp;

&nbsp;

ğŸ“Œ ì „ì²´ë™ê¸°í™”

&nbsp;

```java
if (syncToken == null) {
   System.out.println("Performing full sync.");
   java.util.Calendar calendar = java.util.Calendar.getInstance();
   calendar.add(java.util.Calendar.YEAR, -1);
   Date oneYearAgo = calendar.getTime();
   request.setTimeMin(new DateTime(oneYearAgo, TimeZone.getTimeZone("UTC")));
  }
```

&nbsp;

ë™ê¸°í™” í† í°ì´ ì—†ìœ¼ë©´ ì „ì²´ë™ê¸°í™”ë¥¼ ìˆ˜í–‰(1ë…„ ì „ë¶€í„° í˜„ì¬ê¹Œì§€ë§Œ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •)

&nbsp;

&nbsp;

ğŸ“Œ ì´ë²¤íŠ¸ ëª©ë¡

&nbsp;

```java

Calendar.Events.List request = client.events().list("primary");

String syncToken = syncSettingsDataStore.get(SYNC_TOKEN_KEY);

    // . . .
else {
   System.out.println("Performing incremental sync.");
   request.setSyncToken(syncToken);
  }

  // . . .

  events = request.execute();
```

&nbsp;

ë™ê¸°í™” í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒìœ¼ë¡œ ì´ë²¤íŠ¸ì—ëŠ” ìµœê·¼ ë³€ê²½ëœ ì´ë²¤íŠ¸ë“¤ë§Œ í¬í•¨
ë”°ë¼ì„œ ë³€ê²½ëœ ì´ë²¤íŠ¸ê°€ ì—†ë‹¤ë©´ ê°€ì ¸ì˜¬ ì´ë²¤íŠ¸ ë˜í•œ ì—†ë‹¤

&nbsp;

> `client.events().list("primary")` : ê¸°ë³¸ ìº˜ë¦°ë”ì—ì„œ ì´ë²¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ìš”ì²­ ì¤€ë¹„

&nbsp;

> `request.execute()` : ì¤€ë¹„ëœ ìš”ì²­ì´ ì‹¤ì œë¡œ ì„œë¹„ìŠ¤ì— ì „ì†¡

&nbsp;

&nbsp;

ğŸ“Œ ì´ë²¤íŠ¸ ê²€ìƒ‰

&nbsp;

```java
do {
    request.setPageToken(pageToken); // ì´ë²¤íŠ¸í˜ì´ì§€ ê²€ìƒ‰
    try {
    events = request.execute(); //ì´ë²¤íŠ¸ ìš”ì²­
    //. . .
    }

    List<Event> items = events.getItems();
   if (items.size() == 0) {
    System.out.println("No new events to sync.");
   } else {
    for (Event event : items) {
     syncEvent(event); //ì´ë²¤íŠ¸ ë™ê¸°í™”
    }
   }

   pageToken = events.getNextPageToken(); //ë‹¤ìŒí˜ì´ì§€í† í° ì„¤ì •
} while (pageToken != null);

```

&nbsp;

ì´ë²¤íŠ¸ë¥¼ ê²€ìƒ‰í•˜ê³  ìƒˆë¡œìš´ ì´ë²¤íŠ¸ê°€ ìˆë‹¤ë©´ ì´ë¥¼ ë™ê¸°í™” í•˜ëŠ” ê²ƒì„ ë‹¤ìŒ í˜ì´ì§€ í† í°ì´ ì—†ì„ ë•Œê¹Œì§€ ë°˜ë³µ

&nbsp;

&nbsp;

ğŸ“Œ ë™ê¸°í™” í† í° ë¬´íš¨í™”

&nbsp;

```java
try { //í† í° ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œ
    events = request.execute();
   } catch (GoogleJsonResponseException e) {
    if (e.getStatusCode() == 410) {
     System.out.println("Invalid sync token, clearing event store and re-syncing.");
     syncSettingsDataStore.delete(SYNC_TOKEN_KEY); //ì €ì¥ëœ ë™ê¸°í™” í† í° ì‚­ì œ
     eventDataStore.clear(); //ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì§€ìš°ê¸°
     run(); //ì „ì²´ë™ê¸°í™” ìˆ˜í–‰
    } else {
     throw e;
    }
   }
```

&nbsp;

í† í° ë§Œë£Œ ë˜ëŠ” ê´€ë ¨ ACL ë³€ê²½ì‚¬í•­ ë“±ì˜ ì´ìœ ë¡œ ë™ê¸°í™” í† í°ì´ ë¬´íš¨í™” ë  ê²½ìš° HTTP ìƒíƒœ ì½”ë“œ 410
ì €ì¥ëœ ë™ê¸°í™” í† í° ì‚­ì œí•˜ê³  ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ì†Œë¥¼ ì§€ìš´ í›„ ì „ì²´ ë™ê¸°í™”ë¥¼ ë‹¤ì‹œ ìˆ˜í–‰

&nbsp;

&nbsp;

ğŸ“Œ ì´ë²¤íŠ¸ ë™ê¸°í™”

&nbsp;

```java
private static void syncEvent(Event event) throws IOException {
  if ("cancelled".equals(event.getStatus()) && eventDataStore.containsKey(event.getId())) { //ì´ë²¤íŠ¸ê°€ ì·¨ì†Œë˜ì—ˆëŠ”ì§€ í™•ì¸
   eventDataStore.delete(event.getId());
   System.out.println(String.format("Deleting event: ID=%s", event.getId()));
  } else {
   eventDataStore.set(event.getId(), event.toString()); //ì´ë²¤íŠ¸ ë™ê¸°í™”
   System.out.println(
     String.format("Syncing event: ID=%s, Name=%s", event.getId(), event.getSummary()));
  }
 }
```

&nbsp;

ì´ë²¤íŠ¸ê°€ ì·¨ì†Œë˜ë©´ ë°ì´í„° ì €ì¥ì†Œì—ì„œ ì‚­ì œí•˜ê³ , ì•„ë‹ˆë¼ë©´ ë°ì´í„° ì €ì¥ì†Œì— ì €ì¥

&nbsp;

> `.equals(event.getStatus())` : ì´ë²¤íŠ¸ ìƒíƒœ í™•ì¸

&nbsp;

> `.containsKey(event.getId())` : ë°ì´í„° ì €ì¥ì†Œì— í•´ë‹¹ ì´ë²¤íŠ¸ ID ìˆëŠ”ì§€ í™•ì¸

&nbsp;

> `.delete(event.getId())` : í•´ë‹¹ ì´ë²¤íŠ¸ ì‚­ì œ

&nbsp;

&nbsp;

ğŸ“Œ ì „ì²´ ì½”ë“œ

&nbsp;

```java
private static void run() throws IOException {
  Calendar.Events.List request = client.events().list("primary");
  String syncToken = syncSettingsDataStore.get(SYNC_TOKEN_KEY); //ì €ì¥ëœ ë™ê¸°í™” í† í° ë¡œë“œ
  if (syncToken == null) {
   System.out.println("Performing full sync.");
   java.util.Calendar calendar = java.util.Calendar.getInstance();
   calendar.add(java.util.Calendar.YEAR, -1);
   Date oneYearAgo = calendar.getTime();
   request.setTimeMin(new DateTime(oneYearAgo, TimeZone.getTimeZone("UTC")));
  } else {
   System.out.println("Performing incremental sync.");
   request.setSyncToken(syncToken);
  }


  String pageToken = null;
  Events events = null;
  do {
   request.setPageToken(pageToken);

   try {
    events = request.execute();
   } catch (GoogleJsonResponseException e) {
    if (e.getStatusCode() == 410) { //í† í° ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œ
     System.out.println("Invalid sync token, clearing event store and re-syncing.");
     syncSettingsDataStore.delete(SYNC_TOKEN_KEY); //ì €ì¥ëœ ë™ê¸°í™” í† í° ì‚­ì œ
     eventDataStore.clear(); //ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì§€ìš°ê¸°
     run(); //ì „ì²´ë™ê¸°í™” ìˆ˜í–‰
    } else {
     throw e;
    }
   }

   List<Event> items = events.getItems();
   if (items.size() == 0) {
    System.out.println("No new events to sync.");
   } else {
    for (Event event : items) {
     syncEvent(event);
    }
   }

   pageToken = events.getNextPageToken();
  } while (pageToken != null);


  syncSettingsDataStore.set(SYNC_TOKEN_KEY, events.getNextSyncToken());
  System.out.println("Sync complete.");
 }

 private static void syncEvent(Event event) throws IOException {
  if ("cancelled".equals(event.getStatus()) && eventDataStore.containsKey(event.getId())) {
   eventDataStore.delete(event.getId());
   System.out.println(String.format("Deleting event: ID=%s", event.getId()));
  } else {
   eventDataStore.set(event.getId(), event.toString());
   System.out.println(
     String.format("Syncing event: ID=%s, Name=%s", event.getId(), event.getSummary()));
  }
 }
```

&nbsp;

&nbsp;

---

ì¶œì²˜:[GoogleWorkspace](https://developers.google.com/calendar/api/guides/overview?hl=ko)
